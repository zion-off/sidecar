const I='<svg class="handlebar-svg" id="drag-handlebar-svg" width="2" height="20" viewBox="0 0 2 20" xmlns="http://www.w3.org/2000/svg"><rect width="2" height="20"/></svg>',M='<svg class="handlebar-svg" id="open-handlebar-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path fill-rule="evenodd" d="M7.913 19.071l7.057-7.078-7.057-7.064a1 1 0 011.414-1.414l7.764 7.77a1 1 0 010 1.415l-7.764 7.785a1 1 0 01-1.414-1.414z" clip-rule="evenodd"></path></svg>';function x(){var a;const t=document.querySelector('.text-title-large a[href*="/problems/"]')||document.querySelector('a[href*="/problems/"]:first-of-type');return((a=t==null?void 0:t.textContent)==null?void 0:a.trim())||"Unknown Problem"}function R(){const t=document.querySelector('[data-track-load="description_content"]');return(t==null?void 0:t.innerHTML)||""}function N(){var n,s;const t=document.querySelector('button[aria-haspopup="dialog"] .svg-inline--fa.fa-chevron-down');if(t&&t.parentElement){const l=(s=(n=t.parentElement.childNodes[0])==null?void 0:n.textContent)==null?void 0:s.trim();if(l)return l}const a=document.querySelectorAll('button[aria-haspopup="dialog"]');for(const c of a)if(c.querySelector(".fa-chevron-down")){const d=Array.from(c.childNodes).find(m=>{var u;return m.nodeType===Node.TEXT_NODE&&((u=m.textContent)==null?void 0:u.trim())});if(d&&d.textContent)return d.textContent.trim()}return"Unknown"}function P(){const t=document.querySelector('.view-lines[role="presentation"]');if(!t)return"";const a=t.querySelectorAll(".view-line"),n=[];return a.forEach(s=>{const l=(s.textContent||"").replace(/\u00A0/g," ");n.push(l)}),n.join(`
`)}async function W(){const t=document.createElement("iframe");t.id="extension-iframe",t.allow="clipboard-read; clipboard-write",t.src=chrome.runtime.getURL("index.html");function a(){if(t.contentWindow){const e=x();t.contentWindow.postMessage({type:"PROBLEM_TITLE_UPDATE",data:{title:e,timestamp:Date.now()}},"*")}}window.addEventListener("message",e=>{var S;if(e.source!==t.contentWindow)return;const{type:o,code:i,highlights:r,suggestion:v,isAccept:L}=e.data;switch(o){case"REQUEST_PROBLEM_TITLE":a();break;case"GET_PROBLEM_DATA":(S=t.contentWindow)==null||S.postMessage({type:"PROBLEM_DATA_RESPONSE",data:{title:x(),description:R(),editorContent:P(),language:N(),timestamp:Date.now()}},"*");break;case"INJECT_CODE":chrome.runtime.sendMessage({type:"INJECT_CODE_FROM_CONTENT_SCRIPT",code:i},g=>{var b;chrome.runtime.lastError&&console.error(chrome.runtime.lastError),(b=t.contentWindow)==null||b.postMessage({type:"INJECTION_RESULT",success:g==null?void 0:g.success,message:g!=null&&g.success?"Code injected successfully!":"Failed to inject code"},"*")});break;case"HIGHLIGHT_LINES":chrome.runtime.sendMessage({type:"HIGHLIGHT_LINES_FROM_CONTENT_SCRIPT",highlights:r});break;case"SHOW_SUGGESTION":chrome.runtime.sendMessage({type:"SHOW_SUGGESTION_FROM_CONTENT_SCRIPT",suggestion:v});break;case"RESOLVE_SUGGESTION":chrome.runtime.sendMessage({type:"RESOLVE_SUGGESTION_FROM_CONTENT_SCRIPT",isAccept:L});break}}),window.addEventListener("message",e=>{var o,i;e.source!==window||!((o=e.data.type)!=null&&o.startsWith("SUGGESTION_"))||e.data.type==="SUGGESTION_RESOLVED_FROM_PAGE"&&((i=t.contentWindow)==null||i.postMessage({type:"SUGGESTION_RESOLVED"},"*"))},!1);const n=document.createElement("div");n.id="extension-handlebar",n.style.minWidth="8px",n.style.userSelect="none",n.style.position="relative";const s=document.createElement("div");s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.display="none";let c=!1,l=0,d=!0;function m(e){c=!0,l=e.clientX,s.style.display="block"}n.addEventListener("mousedown",e=>{if(!d){u(!0);return}m(e)}),n.addEventListener("dragstart",e=>e.preventDefault());function u(e){e?(t.style.display="block",n.innerHTML=`
            <div id="handlebar-highlight">${I}</div>
            `,n.style.cursor="ew-resize",chrome.storage.local.set({extensionToggleState:!0}),d=!0,n.style.zIndex="10"):(t.style.display="none",n.innerHTML=M,n.style.cursor="pointer",chrome.storage.local.set({extensionToggleState:!1}),d=!1,n.style.zIndex="0")}function E(){chrome.storage.local.get("extensionToggleState",e=>{var o;u((o=e.extensionToggleState)!=null?o:!0)}),chrome.storage.local.set({shouldShowPanel:!0}),n.style.display="flex"}function p(){chrome.storage.local.set({shouldShowPanel:!1}),t.style.display="none",n.style.display="none"}n.addEventListener("dblclick",()=>{d&&u(!1)});function _(){c=!1,s.style.display="none"}function C(e,o){let i;return(...r)=>{i||(e(...r),i=!0,setTimeout(()=>i=!1,o))}}const h=350,f=800;function O(e){if(!c)return;const o=l-e.clientX;l=e.clientX;let r=parseInt(t.style.width)+o;if(d&&l-window.innerWidth-h>-450){u(!1);return}else if(!d&&l-window.innerWidth-h<-450){u(!0);return}if(r<h)r=h,o<0&&e.clientX>n.getBoundingClientRect().right&&(l=e.clientX);else if(r>f)r=f,o>0&&e.clientX<n.getBoundingClientRect().left&&(l=e.clientX);else if(o<0&&e.clientX>n.getBoundingClientRect().right)r=Math.max(h,Math.min(r,f));else if(o>0&&e.clientX<n.getBoundingClientRect().left)r=Math.max(h,Math.min(r,f));else return;t.style.width=`${r}px`,chrome.storage.local.set({extensionWidth:r})}window.addEventListener("mousemove",C(O,16)),window.addEventListener("mouseup",_),chrome.storage.local.get("extensionToggleState",e=>{var o;u((o=e.extensionToggleState)!=null?o:!0)}),chrome.storage.local.get("extensionWidth",e=>{var i;const o=(i=e.extensionWidth)!=null?i:"525";t.style.width=`${o}px`}),chrome.storage.local.get("shouldShowPanel",e=>{var i;((i=e.shouldShowPanel)!=null?i:!0)?E():p()});const w=await G(["#qd-content"]);w.insertAdjacentElement("afterend",s),w.insertAdjacentElement("afterend",t),w.insertAdjacentElement("afterend",n);let y=!1;const T=()=>{y||(a(),y=!0)};t.addEventListener("load",()=>{setTimeout(T,100)}),setTimeout(T,1e3),chrome.storage.onChanged.addListener(e=>{for(const[o,{newValue:i}]of Object.entries(e))o==="shouldShowPanel"&&(i===!0?E():p()),o==="extensionToggleState"&&u(i===!0),o==="extensionWidth"&&(t.style.width=`${i}px`)})}function G(t){return new Promise(a=>{const n=new MutationObserver(()=>{for(const s of t){const c=document.querySelector(s);if(c){a(c),n.disconnect();return}}});n.observe(document.body,{childList:!0,subtree:!0})})}W();

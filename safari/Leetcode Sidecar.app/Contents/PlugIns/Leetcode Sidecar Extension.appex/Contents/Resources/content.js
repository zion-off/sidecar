const M='<svg class="handlebar-svg" id="drag-handlebar-svg" width="2" height="20" viewBox="0 0 2 20" xmlns="http://www.w3.org/2000/svg"><rect width="2" height="20"/></svg>',N='<svg class="handlebar-svg" id="open-handlebar-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path fill-rule="evenodd" d="M7.913 19.071l7.057-7.078-7.057-7.064a1 1 0 011.414-1.414l7.764 7.77a1 1 0 010 1.415l-7.764 7.785a1 1 0 01-1.414-1.414z" clip-rule="evenodd"></path></svg>';function _(){var r;const e=document.querySelector('.text-title-large a[href*="/problems/"]')||document.querySelector('a[href*="/problems/"]:first-of-type');return((r=e==null?void 0:e.textContent)==null?void 0:r.trim())||"Unknown Problem"}function R(){const e=document.querySelector('[data-track-load="description_content"]');return(e==null?void 0:e.innerHTML)||""}function v(){var n,s;const e=document.querySelector('button[aria-haspopup="dialog"] .svg-inline--fa.fa-chevron-down');if(e&&e.parentElement){const a=(s=(n=e.parentElement.childNodes[0])==null?void 0:n.textContent)==null?void 0:s.trim();if(a)return a}const r=document.querySelectorAll('button[aria-haspopup="dialog"]');for(const c of r)if(c.querySelector(".fa-chevron-down")){const d=Array.from(c.childNodes).find(f=>{var u;return f.nodeType===Node.TEXT_NODE&&((u=f.textContent)==null?void 0:u.trim())});if(d&&d.textContent)return d.textContent.trim()}return"Unknown"}function b(){const e=document.querySelector('.view-lines[role="presentation"]');if(!e)return"";const r=e.querySelectorAll(".view-line"),n=[];return r.forEach(s=>{const a=(s.textContent||"").replace(/\u00A0/g," ");n.push(a)}),n.join(`
`)}async function P(){return new Promise(e=>{chrome.runtime.sendMessage({type:"GET_EDITOR_CONTENT_FROM_CONTENT_SCRIPT"},r=>{if(chrome.runtime.lastError)console.error("Error getting editor content from background:",chrome.runtime.lastError),e(b());else{const n=(r==null?void 0:r.content)||"";n.trim().length>0?e(n):(console.error("Background script returned empty content, using DOM fallback"),e(b()))}})})}async function W(){const e=document.createElement("iframe");e.id="extension-iframe",e.allow="clipboard-read; clipboard-write",e.src=chrome.runtime.getURL("index.html");function r(){if(e.contentWindow){const t=_();e.contentWindow.postMessage({type:"PROBLEM_TITLE_UPDATE",data:{title:t,timestamp:Date.now()}},"*")}}window.addEventListener("message",t=>{if(t.source!==e.contentWindow)return;const{type:o,code:i,highlights:l,suggestion:I,isAccept:L}=t.data;switch(o){case"REQUEST_PROBLEM_TITLE":r();break;case"GET_PROBLEM_DATA":(async()=>{var m;const h=await P();(m=e.contentWindow)==null||m.postMessage({type:"PROBLEM_DATA_RESPONSE",data:{title:_(),description:R(),editorContent:h,language:v(),timestamp:Date.now()}},"*")})();break;case"INJECT_CODE":chrome.runtime.sendMessage({type:"INJECT_CODE_FROM_CONTENT_SCRIPT",code:i},h=>{var m;chrome.runtime.lastError&&console.error(chrome.runtime.lastError),(m=e.contentWindow)==null||m.postMessage({type:"INJECTION_RESULT",success:h==null?void 0:h.success,message:h!=null&&h.success?"Code injected successfully!":"Failed to inject code"},"*")});break;case"HIGHLIGHT_LINES":chrome.runtime.sendMessage({type:"HIGHLIGHT_LINES_FROM_CONTENT_SCRIPT",highlights:l});break;case"SHOW_SUGGESTION":chrome.runtime.sendMessage({type:"SHOW_SUGGESTION_FROM_CONTENT_SCRIPT",suggestion:I});break;case"RESOLVE_SUGGESTION":chrome.runtime.sendMessage({type:"RESOLVE_SUGGESTION_FROM_CONTENT_SCRIPT",isAccept:L});break}}),window.addEventListener("message",t=>{var o,i;t.source!==window||!((o=t.data.type)!=null&&o.startsWith("SUGGESTION_"))||t.data.type==="SUGGESTION_RESOLVED_FROM_PAGE"&&((i=e.contentWindow)==null||i.postMessage({type:"SUGGESTION_RESOLVED"},"*"))},!1);const n=document.createElement("div");n.id="extension-handlebar",n.style.minWidth="8px",n.style.userSelect="none",n.style.position="relative";const s=document.createElement("div");s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.display="none";let c=!1,a=0,d=!0;function f(t){c=!0,a=t.clientX,s.style.display="block"}n.addEventListener("mousedown",t=>{if(!d){u(!0);return}f(t)}),n.addEventListener("dragstart",t=>t.preventDefault());function u(t){t?(e.style.display="block",n.innerHTML=`
            <div id="handlebar-highlight">${M}</div>
            `,n.style.cursor="ew-resize",chrome.storage.local.set({extensionToggleState:!0}),d=!0,n.style.zIndex="10"):(e.style.display="none",n.innerHTML=N,n.style.cursor="pointer",chrome.storage.local.set({extensionToggleState:!1}),d=!1,n.style.zIndex="0")}function y(){chrome.storage.local.get("extensionToggleState",t=>{var o;u((o=t.extensionToggleState)!=null?o:!0)}),chrome.storage.local.set({shouldShowPanel:!0}),n.style.display="flex"}function T(){chrome.storage.local.set({shouldShowPanel:!1}),e.style.display="none",n.style.display="none"}n.addEventListener("dblclick",()=>{d&&u(!1)});function x(){c=!1,s.style.display="none"}function O(t,o){let i;return(...l)=>{i||(t(...l),i=!0,setTimeout(()=>i=!1,o))}}const g=350,E=800;function C(t){if(!c)return;const o=a-t.clientX;a=t.clientX;let l=parseInt(e.style.width)+o;if(d&&a-window.innerWidth-g>-450){u(!1);return}else if(!d&&a-window.innerWidth-g<-450){u(!0);return}if(l<g)l=g,o<0&&t.clientX>n.getBoundingClientRect().right&&(a=t.clientX);else if(l>E)l=E,o>0&&t.clientX<n.getBoundingClientRect().left&&(a=t.clientX);else if(o<0&&t.clientX>n.getBoundingClientRect().right)l=Math.max(g,Math.min(l,E));else if(o>0&&t.clientX<n.getBoundingClientRect().left)l=Math.max(g,Math.min(l,E));else return;e.style.width=`${l}px`,chrome.storage.local.set({extensionWidth:l})}window.addEventListener("mousemove",O(C,16)),window.addEventListener("mouseup",x),chrome.storage.local.get("extensionToggleState",t=>{var o;u((o=t.extensionToggleState)!=null?o:!0)}),chrome.storage.local.get("extensionWidth",t=>{var i;const o=(i=t.extensionWidth)!=null?i:"525";e.style.width=`${o}px`}),chrome.storage.local.get("shouldShowPanel",t=>{var i;((i=t.shouldShowPanel)!=null?i:!0)?y():T()});const w=await G(["#qd-content"]);w.insertAdjacentElement("afterend",s),w.insertAdjacentElement("afterend",e),w.insertAdjacentElement("afterend",n);let p=!1;const S=()=>{p||(r(),p=!0)};e.addEventListener("load",()=>{setTimeout(S,100)}),setTimeout(S,1e3),chrome.storage.onChanged.addListener(t=>{for(const[o,{newValue:i}]of Object.entries(t))o==="shouldShowPanel"&&(i===!0?y():T()),o==="extensionToggleState"&&u(i===!0),o==="extensionWidth"&&(e.style.width=`${i}px`)})}function G(e){return new Promise(r=>{const n=new MutationObserver(()=>{for(const s of e){const c=document.querySelector(s);if(c){r(c),n.disconnect();return}}});n.observe(document.body,{childList:!0,subtree:!0})})}W();

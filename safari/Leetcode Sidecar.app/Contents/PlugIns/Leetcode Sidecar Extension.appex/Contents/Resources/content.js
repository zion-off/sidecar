const A='<svg class="handlebar-svg" id="drag-handlebar-svg" width="2" height="20" viewBox="0 0 2 20" xmlns="http://www.w3.org/2000/svg"><rect width="2" height="20"/></svg>',H='<svg class="handlebar-svg" id="open-handlebar-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path fill-rule="evenodd" d="M7.913 19.071l7.057-7.078-7.057-7.064a1 1 0 011.414-1.414l7.764 7.77a1 1 0 010 1.415l-7.764 7.785a1 1 0 01-1.414-1.414z" clip-rule="evenodd"></path></svg>';async function q(){const i=document.createElement("iframe");i.id="extension-iframe",i.allow="clipboard-read; clipboard-write",i.src=chrome.runtime.getURL("index.html");function w(){var s;const e=document.querySelector('[data-track-load="description_content"]');function t(){const l=document.querySelector('.view-lines[role="presentation"]');if(!l)return"";const h=l.querySelectorAll(".view-line"),r=[];return h.forEach(c=>{const p=(c.textContent||"").replace(/\u00A0/g," ");r.push(p)}),r.join(`
`)}function o(){var r,c;const l=document.querySelector('button[aria-haspopup="dialog"] .svg-inline--fa.fa-chevron-down');if(l&&l.parentElement){const p=(c=(r=l.parentElement.childNodes[0])==null?void 0:r.textContent)==null?void 0:c.trim();if(p)return p}const h=document.querySelectorAll('button[aria-haspopup="dialog"]');for(const E of h)if(E.querySelector(".fa-chevron-down")){const T=Array.from(E.childNodes).find(I=>{var L;return I.nodeType===Node.TEXT_NODE&&((L=I.textContent)==null?void 0:L.trim())});if(T&&T.textContent)return T.textContent.trim()}return"Unknown"}if(e&&i.contentWindow){const l=document.querySelector('.text-title-large a[href*="/problems/"]')||document.querySelector('a[href*="/problems/"]:first-of-type'),h=((s=l==null?void 0:l.textContent)==null?void 0:s.trim())||"Unknown Problem",r=t(),c=o();i.contentWindow.postMessage({type:"PAGE_DATA_UPDATE",data:{title:h,description:e.innerHTML,editorContent:r,language:c,timestamp:Date.now()}},"*")}}window.addEventListener("message",e=>{if(e.source!==i.contentWindow)return;const{type:t,code:o,highlights:s,suggestion:l,isAccept:h}=e.data;switch(t){case"INJECT_CODE":chrome.runtime.sendMessage({type:"INJECT_CODE_FROM_CONTENT_SCRIPT",code:o},r=>{var c;chrome.runtime.lastError&&console.error(chrome.runtime.lastError),(c=i.contentWindow)==null||c.postMessage({type:"INJECTION_RESULT",success:r==null?void 0:r.success,message:r!=null&&r.success?"Code injected successfully!":"Failed to inject code"},"*")});break;case"HIGHLIGHT_LINES":chrome.runtime.sendMessage({type:"HIGHLIGHT_LINES_FROM_CONTENT_SCRIPT",highlights:s});break;case"SHOW_SUGGESTION":chrome.runtime.sendMessage({type:"SHOW_SUGGESTION_FROM_CONTENT_SCRIPT",suggestion:l});break;case"RESOLVE_SUGGESTION":chrome.runtime.sendMessage({type:"RESOLVE_SUGGESTION_FROM_CONTENT_SCRIPT",isAccept:h});break}}),window.addEventListener("message",e=>{var t,o;e.source!==window||!((t=e.data.type)!=null&&t.startsWith("SUGGESTION_"))||e.data.type==="SUGGESTION_RESOLVED_FROM_PAGE"&&((o=i.contentWindow)==null||o.postMessage({type:"SUGGESTION_RESOLVED"},"*"))},!1);const n=document.createElement("div");n.id="extension-handlebar",n.style.minWidth="8px",n.style.userSelect="none",n.style.position="relative";const a=document.createElement("div");a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.width="100%",a.style.height="100%",a.style.display="none";let g=!1,d=0,m=!0;function N(e){g=!0,d=e.clientX,a.style.display="block"}n.addEventListener("mousedown",e=>{if(!m){u(!0);return}N(e)}),n.addEventListener("dragstart",e=>e.preventDefault());function u(e){e?(i.style.display="block",n.innerHTML=`
            <div id="handlebar-highlight">${A}</div>
            `,n.style.cursor="ew-resize",chrome.storage.local.set({extensionToggleState:!0}),m=!0,n.style.zIndex="10"):(i.style.display="none",n.innerHTML=H,n.style.cursor="pointer",chrome.storage.local.set({extensionToggleState:!1}),m=!1,n.style.zIndex="0")}function b(){chrome.storage.local.get("extensionToggleState",e=>{var t;u((t=e.extensionToggleState)!=null?t:!0)}),chrome.storage.local.set({shouldShowPanel:!0}),n.style.display="flex"}function x(){chrome.storage.local.set({shouldShowPanel:!1}),i.style.display="none",n.style.display="none"}n.addEventListener("dblclick",()=>{m&&u(!1)});function M(){g=!1,a.style.display="none"}function G(e,t){let o;return(...s)=>{o||(e(...s),o=!0,setTimeout(()=>o=!1,t))}}const f=350,y=800;function R(e){if(!g)return;const t=d-e.clientX;d=e.clientX;let s=parseInt(i.style.width)+t;if(m&&d-window.innerWidth-f>-450){u(!1);return}else if(!m&&d-window.innerWidth-f<-450){u(!0);return}if(s<f)s=f,t<0&&e.clientX>n.getBoundingClientRect().right&&(d=e.clientX);else if(s>y)s=y,t>0&&e.clientX<n.getBoundingClientRect().left&&(d=e.clientX);else if(t<0&&e.clientX>n.getBoundingClientRect().right)s=Math.max(f,Math.min(s,y));else if(t>0&&e.clientX<n.getBoundingClientRect().left)s=Math.max(f,Math.min(s,y));else return;i.style.width=`${s}px`,chrome.storage.local.set({extensionWidth:s})}window.addEventListener("mousemove",G(R,16)),window.addEventListener("mouseup",M),chrome.storage.local.get("extensionToggleState",e=>{var t;u((t=e.extensionToggleState)!=null?t:!0)}),chrome.storage.local.get("extensionWidth",e=>{var o;const t=(o=e.extensionWidth)!=null?o:"525";i.style.width=`${t}px`}),chrome.storage.local.get("shouldShowPanel",e=>{var o;((o=e.shouldShowPanel)!=null?o:!0)?b():x()});const S=await D(["#qd-content"]);S.insertAdjacentElement("afterend",a),S.insertAdjacentElement("afterend",i),S.insertAdjacentElement("afterend",n),w();let v;const W=new MutationObserver(()=>{clearTimeout(v),v=setTimeout(()=>{w()},500)}),C=document.querySelector("#qd-content");C&&W.observe(C,{childList:!0,subtree:!0});let O;const P=new MutationObserver(()=>{clearTimeout(O),O=setTimeout(()=>{w()},200)}),_=()=>{const e=document.querySelector('.view-lines[role="presentation"]');e?P.observe(e,{childList:!0,subtree:!0,characterData:!0}):setTimeout(_,1e3)};_(),chrome.storage.onChanged.addListener(e=>{for(const[t,{newValue:o}]of Object.entries(e))t==="shouldShowPanel"&&(o===!0?b():x()),t==="extensionToggleState"&&u(o===!0),t==="extensionWidth"&&(i.style.width=`${o}px`)})}function D(i){return new Promise(w=>{const n=new MutationObserver(()=>{for(const a of i){const g=document.querySelector(a);if(g){w(g),n.disconnect();return}}});n.observe(document.body,{childList:!0,subtree:!0})})}q();

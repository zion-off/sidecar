function E(s){try{const n=window.monaco;if(n&&n.editor){const i=n.editor.getEditors()[0];if(i){const e=i.getModel();if(e){const c=e.getFullModelRange();return i.executeEdits("my-extension-source",[{range:c,text:s,forceMoveMarkers:!0}]),!0}}}return!1}catch(n){return console.error("[Extension] Error during code injection:",n),!1}}function S(s){var n;try{let i=function(g){try{g&&r&&r.setValue(d.getValue()),f.dispose(),l.dispose(),d.dispose(),t==null||t.remove(),o&&(o.style.display="")}catch(p){console.error("[Extension] diff cleanup error",p)}window.postMessage({type:"SUGGESTION_RESOLVED_FROM_PAGE"},"*")};const e=window.monaco;if(!e)return;const c=e.editor.getEditors()[0];if(!c)return;if(typeof window.resolveSuggestion=="function")try{window.resolveSuggestion(!1)}catch{}const r=c.getModel(),a=((n=r==null?void 0:r.getLanguageId)==null?void 0:n.call(r))||"plaintext",l=e.editor.createModel(s.originalCode,a),d=e.editor.createModel(s.suggestedCode,a),o=c.getDomNode();if(!o||!o.parentElement)return;o.style.display="none";const u="extension-inline-diff-container";let t=document.getElementById(u);t&&t.remove(),t=document.createElement("div"),t.id=u,t.style.width="100%",t.style.height=o.style.height||"100%",t.style.position="relative",o.parentElement.appendChild(t);const f=e.editor.createDiffEditor(t,{automaticLayout:!0,renderSideBySide:!1,originalEditable:!1,hideUnchangedRegions:{enabled:!0},minimap:{enabled:!1}});f.setModel({original:l,modified:d}),window.resolveSuggestion=g=>i(g)}catch(i){console.error("[Extension] Error showing suggestion:",i)}}function m(s){typeof window.resolveSuggestion=="function"&&window.resolveSuggestion(s)}chrome.runtime.onMessage.addListener((s,n,i)=>{var d;const e=(d=n.tab)==null?void 0:d.id;if(!e)return!0;const{type:c,code:r,suggestion:a,isAccept:l}=s;switch(c){case"INJECT_CODE_FROM_CONTENT_SCRIPT":chrome.scripting.executeScript({target:{tabId:e},func:E,args:[r],world:"MAIN"}).then(o=>i({success:o[0].result})).catch(o=>console.error(o));break;case"SHOW_SUGGESTION_FROM_CONTENT_SCRIPT":chrome.scripting.executeScript({target:{tabId:e},func:S,args:[a],world:"MAIN"});break;case"RESOLVE_SUGGESTION_FROM_CONTENT_SCRIPT":chrome.scripting.executeScript({target:{tabId:e},func:m,args:[l],world:"MAIN"});break}return!0});

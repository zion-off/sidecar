function m(n){try{const r=window.monaco;if(r&&r.editor){const t=r.editor.getEditors()[0];if(t){const e=t.getModel();if(e){const s=e.getFullModelRange();return t.executeEdits("my-extension-source",[{range:s,text:n,forceMoveMarkers:!0}]),!0}}}return!1}catch(r){return console.error("[Extension] Error during code injection:",r),!1}}function p(){try{const n=window.monaco;if(n&&n.editor){const r=n.editor.getEditors();for(let t=0;t<r.length;t++){const e=r[t];if(e){const s=e.getModel();if(s){const i=s.getValue();if(i.trim().length>0)return i}}}}}catch(n){console.error("[Extension] Error getting editor content:",n)}return""}function S(n){var r;try{let t=function(g){try{g&&i&&i.setValue(d.getValue()),f.dispose(),l.dispose(),d.dispose(),c==null||c.remove(),o&&(o.style.display="")}catch(E){console.error("[Extension] diff cleanup error",E)}window.postMessage({type:"SUGGESTION_RESOLVED_FROM_PAGE"},"*")};const e=window.monaco;if(!e)return;const s=e.editor.getEditors()[0];if(!s)return;if(typeof window.resolveSuggestion=="function")try{window.resolveSuggestion(!1)}catch{}const i=s.getModel(),a=((r=i==null?void 0:i.getLanguageId)==null?void 0:r.call(i))||"plaintext",l=e.editor.createModel(n.originalCode,a),d=e.editor.createModel(n.suggestedCode,a),o=s.getDomNode();if(!o||!o.parentElement)return;o.style.display="none";const u="extension-inline-diff-container";let c=document.getElementById(u);c&&c.remove(),c=document.createElement("div"),c.id=u,c.style.width="100%",c.style.height=o.style.height||"100%",c.style.position="relative",o.parentElement.appendChild(c);const f=e.editor.createDiffEditor(c,{automaticLayout:!0,renderSideBySide:!1,originalEditable:!1,hideUnchangedRegions:{enabled:!0},minimap:{enabled:!1}});f.setModel({original:l,modified:d}),window.resolveSuggestion=g=>t(g)}catch(t){console.error("[Extension] Error showing suggestion:",t)}}function h(n){typeof window.resolveSuggestion=="function"&&window.resolveSuggestion(n)}chrome.runtime.onMessage.addListener((n,r,t)=>{var d;const e=(d=r.tab)==null?void 0:d.id;if(!e)return!0;const{type:s,code:i,suggestion:a,isAccept:l}=n;switch(s){case"INJECT_CODE_FROM_CONTENT_SCRIPT":chrome.scripting.executeScript({target:{tabId:e},func:m,args:[i],world:"MAIN"}).then(o=>t({success:o[0].result})).catch(o=>console.error(o));break;case"GET_EDITOR_CONTENT_FROM_CONTENT_SCRIPT":chrome.scripting.executeScript({target:{tabId:e},func:p,world:"MAIN"}).then(o=>t({content:o[0].result})).catch(o=>{console.error(o),t({content:""})});break;case"SHOW_SUGGESTION_FROM_CONTENT_SCRIPT":chrome.scripting.executeScript({target:{tabId:e},func:S,args:[a],world:"MAIN"});break;case"RESOLVE_SUGGESTION_FROM_CONTENT_SCRIPT":chrome.scripting.executeScript({target:{tabId:e},func:h,args:[l],world:"MAIN"});break}return!0});

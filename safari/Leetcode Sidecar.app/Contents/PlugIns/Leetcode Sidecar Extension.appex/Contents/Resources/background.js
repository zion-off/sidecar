function p(t){try{const r=window.monaco;if(r&&r.editor){const i=r.editor.getEditors()[0];if(i){const e=i.getModel();if(e){const c=e.getFullModelRange();return i.executeEdits("my-extension-source",[{range:c,text:t,forceMoveMarkers:!0}]),!0}}}return!1}catch(r){return console.error("[Extension] Error during code injection:",r),!1}}function S(t){var r;try{let i=function(u){try{u&&s&&s.setValue(a.getValue()),f.dispose(),l.dispose(),a.dispose(),o==null||o.remove(),n&&(n.style.display="")}catch(m){console.error("[Extension] diff cleanup error",m)}window.postMessage({type:"SUGGESTION_RESOLVED_FROM_PAGE"},"*")};const e=window.monaco;if(!e)return;const c=e.editor.getEditors()[0];if(!c)return;if(typeof window.resolveSuggestion=="function")try{window.resolveSuggestion(!1)}catch{}const s=c.getModel(),d=((r=s==null?void 0:s.getLanguageId)==null?void 0:r.call(s))||"plaintext",l=e.editor.createModel(t.originalCode,d),a=e.editor.createModel(t.suggestedCode,d),n=c.getDomNode();if(!n||!n.parentElement)return;n.style.display="none";const g="extension-inline-diff-container";let o=document.getElementById(g);o&&o.remove(),o=document.createElement("div"),o.id=g,o.style.width="100%",o.style.height=n.style.height||"100%",o.style.position="relative",n.parentElement.appendChild(o);const f=e.editor.createDiffEditor(o,{automaticLayout:!0,renderSideBySide:!1,originalEditable:!1,hideUnchangedRegions:{enabled:!0},minimap:{enabled:!1}});f.setModel({original:l,modified:a}),window.resolveSuggestion=u=>i(u)}catch(i){console.error("[Extension] Error showing suggestion:",i)}}function h(t){typeof window.resolveSuggestion=="function"&&window.resolveSuggestion(t)}chrome.runtime.onMessage.addListener((t,r,i)=>{var a;const e=(a=r.tab)==null?void 0:a.id;if(!e)return!0;const{type:c,code:s,suggestion:d,isAccept:l}=t;switch(c){case"INJECT_CODE_FROM_CONTENT_SCRIPT":chrome.scripting.executeScript({target:{tabId:e},func:p,args:[s],world:"MAIN"}).then(n=>i({success:n[0].result})).catch(n=>console.error(n));break;case"SHOW_SUGGESTION_FROM_CONTENT_SCRIPT":chrome.scripting.executeScript({target:{tabId:e},func:S,args:[d],world:"MAIN"});break;case"RESOLVE_SUGGESTION_FROM_CONTENT_SCRIPT":chrome.scripting.executeScript({target:{tabId:e},func:h,args:[l],world:"MAIN"});break}return!0});var I={}.HOT_RELOAD_EXTENSION_VITE_PORT?parseInt({}.HOT_RELOAD_EXTENSION_VITE_PORT):8080,O=new WebSocket(`ws://localhost:${I}`),E=()=>setInterval(chrome.runtime.getPlatformInfo,2e4);chrome.runtime.onStartup.addListener(E);E();chrome.runtime.onInstalled.addListener(t=>{t.reason===chrome.runtime.OnInstalledReason.UPDATE&&chrome.tabs.reload()});O.addEventListener("message",t=>{t.data==="file-change"&&chrome.runtime.reload()});
